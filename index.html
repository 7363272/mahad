<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Stream</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
</head>

<body class="p-3">

    <div class="d-flex justify-content-center align-self-center card m-2 ms-5 mt-3 p-2" style="width: 90%;">
        <form method="get" class="d-flex justify-content-center gap-3 m-2"
            onsubmit="event.preventDefault(); get_iframe(); return false;">
            <input type="text" id="id" placeholder="IMDb ID (e.g. tt1553656)" required>
            <input type="number" id="season" placeholder="Season Number (e.g. 1)">
            <input type="number" id="episode" placeholder="Episode Number (e.g. 1)">
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <p class="text-info align-self-center">If you want to watch a movie, leave the "Season Number" and "Episode Number" fields empty.
        </p>
    </div>

    <div class="accordion">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#search-accordion" aria-expanded="true" aria-controls="search-accordion">
                    Search By Title
                </button>
            </h2>
            <div id="search-accordion" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    <div>
                        <form method="get" onsubmit="event.preventDefault(); 
                                        search(); return false;">
                            <label for="q_field">Title:</label>
                            <input type="text" id="q_field" placeholder="e.g. John Wick" oninput="search();">
                            <button type="submit" class="btn btn-primary">Search</button>
                        </form>
                    </div>
                    <div id="search-results">

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center p-3" style="width: 100%;">
        <iframe src="" width="1200px" height="600px" allowfullscreen></iframe>
    </div>

    <script type="text/javascript">

        function add_result(item) {
            const results = document.querySelector("#search-results");

            if (results.innerHTML === "No results matching your query!") {
                results.innerHTML = "";
            };

            const card = document.createElement("div");
            card.classList.add("card");
            card.classList.add("d-flex");
            card.classList.add("m-3");
            card.classList.add("p-3");
            card.style.width = "100%";
            card.style.cursor = "pointer";

            const card_body = document.createElement("div");
            card_body.classList.add("card-body");

            const card_image = document.createElement("img");
            card_image.src = item.i;
            card_image.height = "150";
            card_image.width = "150";

            const card_title = document.createElement("h5");
            card_title.classList.add("card-title");
            card_title.innerHTML = item.l + ` (${item.y})`;

            const card_type = document.createElement("h6");
            card_type.classList.add("card-title-secondary");
            card_type.innerHTML = item.q === "feature" ? "Movie" : item.q;

            const card_text = document.createElement("p");
            card_text.classList.add("card-text");
            card_text.innerHTML = item.s;

            const card_id = document.createElement("p");
            card_id.classList.add("card-link");
            card_id.innerHTML = `IMDb ID: ${item.id}`;

            card.appendChild(card_image);
            card_body.appendChild(card_title);
            card_body.appendChild(card_type);
            card_body.appendChild(card_text);
            card_body.appendChild(card_id);

            card.appendChild(card_body);

            card.addEventListener("click", function () {
                document.querySelector("#id").value = item.id;
                window.scrollTo(0, 0);
            });

            results.appendChild(card);
        }

        function search() {
            let q = document.querySelector("#q_field").value;
            q = q.replaceAll(" ", "_");
            //q = encodeURIComponent(q.trim());
            
            console.log(q);

            const results_list = document.querySelector("#search-results");
            console.log(results_list);

            // 2) Using jQuery (JSON-P)
            jQuery.ajax({
                url: `https://sg.media-imdb.com/suggests/f/${q}.json`,
                dataType: 'jsonp',
                cache: true,
                jsonp: false,
                jsonpCallback: `imdb$${q}`
            }).then(function (results) {

                results_list.innerHTML = "No results matching your query!";

                console.log(results);

                for (let item in results.d) {
                    item = results.d[item];
                    console.log(item.id);
                    if (item.id.slice(0, 2) === 'tt') {
                        add_result(item);
                    }
                }
            });

        }

        function get_iframe() {
            iframe = document.querySelector('iframe');

            id = document.querySelector('#id').value;
            season = document.querySelector('#season').value;
            episode = document.querySelector('#episode').value;

            title = document.querySelector('title');

            if (season && episode) {
                iframe.src = `https://multiembed.mov/?video_id=${id}&s=${season}&e=${episode}`;
            }
            else {
                iframe.src = `https://multiembed.mov/?video_id=${id}`;
            }
            iframe.reload();

        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>
</body>

</html>